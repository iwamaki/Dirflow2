# AI File Manager - 実装済み要件一覧

## 1. 基本UI・レイアウト機能

### 1.1 コンポーネントシステム
- **テーマシステム**：ダークテーマ・ライトテーマ切り替え対応
- **レスポンシブデザイン**：モバイル・デスクトップ対応
- **モーダルダイアログ**：設定、ファイル作成、名前変更用モーダル
- **ボタンコンポーネント**：円形ボタン、四角ボタン、アクションボタン
- **入力フィールド**：チャット入力、ファイルパス入力、コンテンツ入力
- **カラーパレット**：CSS変数による統一されたカラーシステム

### 1.2 レイアウト構造
- **ヘッダー**：戻るボタン、パス表示、選択情報、編集・保存・設定ボタン
- **メインコンテンツエリア**：ファイルリスト表示・ファイル編集エリア
- **ボトムナビゲーション**：チャット入力・アクションボタンエリア
- **FABボタン**：フローティングアクションボタン（新規作成）
- **チャットオーバーレイ**：スライドアップ式チャット画面

### 1.3 表示モード切り替え
- **ファイルリストモード**：ディレクトリ・ファイル一覧表示
- **ファイルビューモード**：個別ファイル表示・編集
- **選択モード**：単一・複数ファイル選択状態
- **差分表示モード**：編集前後の差分可視化
- **チャットモード**：AI対話インターフェース

## 2. ファイル操作機能

### 2.1 基本ファイル操作
- **ファイル作成**：パス指定でのファイル作成、初期コンテンツ設定
- **ディレクトリ作成**：ネストしたディレクトリ構造の作成
- **ファイル読み込み**：テキストファイル・Markdownの読み込み表示
- **ファイル編集**：テキストエリアでの直接編集
- **ファイル保存**：編集内容の保存、ファイルサイズ自動更新
- **ファイル削除**：確認ダイアログ付き削除機能
- **ファイルコピー**：任意パスへのファイル・ディレクトリコピー
- **ファイル移動・名前変更**：移動・リネーム機能

### 2.2 一括操作機能
- **一括削除**：複数ファイルの同時削除
- **一括コピー**：複数ファイルの指定ディレクトリへのコピー
- **一括移動**：複数ファイルの指定ディレクトリへの移動
- **バッチ処理**：成功・失敗カウントでの結果報告

### 2.3 ファイル表示・選択機能
- **ファイルアイコン**：拡張子別アイコン表示（📝📄⚙️💛🌐🎨等）
- **ファイルサイズ表示**：バイト数の自動フォーマット（B/KB/MB/GB）
- **Markdownレンダリング**：ヘッダー、コード、リスト、リンク対応
- **単一選択**：クリックでの単一ファイル選択
- **複数選択**：Ctrl/Cmd+クリックでの複数選択
- **長押し選択**：500ms長押しでの選択モード移行

### 2.4 ナビゲーション機能
- **ディレクトリ移動**：フォルダクリックでの移動
- **親ディレクトリ**：「..」表示での上位移動
- **パス表示**：現在位置のブレッドクラム表示
- **選択状態表示**：選択ファイル数・ファイル名表示

## 3. AI統合機能

### 3.1 複数LLMプロバイダー対応
- **Claude (Anthropic)**：claude-3-sonnet/haiku/opus対応
- **OpenAI GPT**：gpt-4/gpt-4-turbo/gpt-3.5-turbo対応
- **Google Gemini**：gemini-1.5-pro/flash/1.0-pro対応
- **プロバイダー切り替え**：設定画面での動的切り替え
- **モデル選択**：プロバイダー別モデル選択ドロップダウン

### 3.2 構造化AI応答システム
- **JSON形式応答**：message+commandsの構造化レスポンス
- **コマンド実行**：AIが生成したファイル操作コマンドの自動実行
- **パースエラー処理**：JSON解析失敗時のフォールバック
- **バリデーション**：危険なコマンドのフィルタリング

### 3.3 AIコマンド体系
- **create_file**：ファイル作成（path, content, description）
- **create_directory**：ディレクトリ作成（path, description）
- **delete_file**：ファイル削除（path, description）
- **copy_file**：ファイルコピー（source, destination, description）
- **move_file**：ファイル移動（source, destination, description）
- **read_file**：ファイル読み込み（path, description）
- **edit_file**：ファイル編集（path, content, description）
- **list_files**：ファイル一覧（path, description）
- **batch_delete**：一括削除（paths[], description）
- **batch_copy**：一括コピー（sources[], destination, description）
- **batch_move**：一括移動（sources[], destination, description）

### 3.4 自然言語処理
- **日本語対応**：完全日本語インターフェース
- **自然な会話**：「〜して」「〜を作って」などの自然な表現理解
- **コンテキスト保持**：現在のディレクトリ・ファイル情報を会話に含める
- **ヘルプ機能**：「help」コマンドでの使用方法表示

## 4. 設定・カスタマイズ機能

### 4.1 外観設定
- **テーマ切り替え**：ダーク・ライトテーマの動的切り替え
- **フォントサイズ**：小・中・大の3段階調整
- **カラーパレット**：CSS変数による統一カラー管理
- **設定永続化**：localStorage による設定保存

### 4.2 AI設定管理
- **プロバイダー選択**：Claude/OpenAI/Gemini切り替え
- **モデル選択**：プロバイダー別モデル動的選択
- **APIキー管理**：環境変数でのAPIキー設定
- **接続状態確認**：リアルタイム接続ステータス表示

### 4.3 システム状態表示
- **サーバー状態**：health check API での状態確認
- **機能可用性**：各機能の利用可能状況表示
- **プロバイダー状態**：各AIプロバイダーの接続状況
- **エラー表示**：接続エラー・設定不備の表示

## 5. 差分表示・編集機能

### 5.1 差分生成・表示
- **LCSアルゴリズム**：最長共通部分列による高精度差分生成
- **行単位差分**：追加・削除・共通行の3種類表示
- **カラーコーディング**：緑（追加）・赤（削除）・グレー（共通）
- **差分統計**：追加行数・削除行数・変更総数の表示
- **行番号表示**：オリジナル・新バージョンの行番号

### 5.2 選択的適用機能
- **変更ブロック選択**：関連する変更をまとめた選択
- **チェックボックスUI**：変更ブロック単位でのON/OFF
- **全選択・全解除**：一括選択切り替えボタン
- **部分適用**：選択した変更のみの適用機能
- **適用前プレビュー**：適用後の内容確認

### 5.3 差分管理システム
- **状態管理**：選択状態・差分データの管理
- **UIシンク**：選択状態とUIの同期
- **内容生成**：選択された変更から最終内容生成
- **リセット機能**：差分モード終了時の状態クリア

## 6. 会話履歴管理機能

### 6.1 履歴保存・管理
- **永続化ストレージ**：localStorage での履歴保存
- **履歴制限**：最大30件での自動ローテーション
- **警告表示**：15件以上で新チャット推奨表示
- **履歴クリア**：手動での履歴全削除機能

### 6.2 コンテキスト管理
- **会話継続**：過去10件の会話をAIに送信
- **ファイル情報**：現在開いているファイル情報を含める
- **ディレクトリ状態**：現在の作業ディレクトリ情報
- **編集状態**：編集モード・選択状態の情報

### 6.3 履歴UI・フィードバック
- **履歴カウンター**：設定画面での履歴数表示
- **プログレスバー**：履歴使用量の視覚化
- **状態インジケーター**：良好・警告状態の表示
- **新チャット提案**：履歴超過時の自動提案

## 7. セキュリティ・エラーハンドリング機能

### 7.1 セキュリティ検証
- **パスバリデーション**：「..」「~」等の危険パス検出
- **システムパス保護**：/etc、/var等のシステムディレクトリ保護
- **コマンド検証**：許可されたアクションのみ実行
- **入力サニタイゼーション**：HTMLエスケープ処理

### 7.2 エラーハンドリング
- **API接続エラー**：フォールバック応答での継続
- **ファイル操作エラー**：詳細エラーメッセージ表示
- **JSON解析エラー**：構造化応答解析失敗時の処理
- **バリデーションエラー**：コマンド検証失敗時の警告

### 7.3 フォールバック機能
- **モック応答**：API接続失敗時のデモ応答
- **プロバイダー切り替え**：主プロバイダー失敗時の代替
- **デグレード動作**：機能制限での継続動作
- **ユーザー通知**：エラー状況の分かりやすい説明

## 8. 技術実装・アーキテクチャ

### 8.1 フロントエンド構成
- **モジュラー設計**：機能別JavaScriptファイル分割
- **状態管理**：AppState による中央集権的状態管理
- **イベント処理**：EventHandler による統一イベント管理
- **UI制御**：UIController による表示制御分離

### 8.2 バックエンド構成
- **Express.js**：RESTful API サーバー
- **CORS対応**：クロスオリジン要求サポート
- **環境変数管理**：dotenv による設定管理
- **静的ファイル配信**：Express static による配信

### 8.3 API設計
- **RESTful エンドポイント**：GET/POST による標準的API
- **構造化レスポンス**：統一されたJSON応答形式
- **エラーレスポンス**：詳細なエラー情報返却
- **ヘルスチェック**：システム状態監視API
